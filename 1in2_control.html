<div class="glass p-8 rounded-[2rem] border border-red-900/30 text-center bg-black">
    <h3 class="orbitron text-red-600 text-[10px] font-black uppercase tracking-widest mb-4 italic">Security Level: Master</h3>
    
    <div id="connection-status" class="mb-4 py-2 bg-zinc-900/50 rounded-lg border border-white/5">
        <p class="text-[8px] text-zinc-500 uppercase font-black">Link Status: <span id="link-text" class="text-yellow-500">Authenticating...</span></p>
    </div>

    <button id="purge-btn" onclick="executeNuclearPurge()" 
        class="w-full py-6 bg-red-600 hover:bg-white hover:text-black text-white rounded-2xl font-black uppercase italic tracking-tighter shadow-lg shadow-red-900/40 transition-all active:scale-95 group border border-red-500/50">
        <span class="group-hover:scale-110 transition-transform inline-block">Nuclear Reset 1in2</span>
    </button>
    
    <p id="purge-status" class="text-[9px] text-zinc-500 mt-4 font-bold uppercase tracking-widest">Awaiting Command</p>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
    // 1. THE DEPLOYED HANDSHAKE
    const SB_URL = 'https://tbvmgcknkwsucstedigd.supabase.co';
    // This is the EXACT key you provided. I have stripped any potential hidden whitespace.
    const SB_KEY = 'EyjhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRidm1nY2tua3dzdWNzdGVkaWdkIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2Nzk4ODAyNCwiZXhwIjoyMDgzNTY0MDI0fQ.XmCY_EFQSxBhzt4ZcFJBb9Ohi2JaF5dPAVXXV4sd13c'.trim(); 

    const sb = window.supabase.createClient(SB_URL, SB_KEY);

    // 2. DIAGNOSTIC HANDSHAKE (Runs on Load)
    async function checkAuth() {
        const linkText = document.getElementById('link-text');
        try {
            const { data, error } = await sb.from('1in2').select('count', { count: 'exact', head: true });
            if (error) throw error;
            linkText.innerText = "SECURE";
            linkText.className = "text-green-500";
        } catch (e) {
            linkText.innerText = "INVALID KEY";
            linkText.className = "text-red-600";
            console.error("Auth Fail:", e.message);
        }
    }
    checkAuth();

    // 3. THE NUCLEAR PURGE
    async function executeNuclearPurge() {
        const btn = document.getElementById('purge-btn');
        const status = document.getElementById('purge-status');
        
        if (!confirm("EJECT ALL PLAYERS AND CLEAR ARENA?")) return;

        btn.disabled = true;
        status.innerText = "PURGING...";
        status.className = "text-[9px] text-red-500 font-black animate-pulse";

        try {
            // STEP 1: FORCE DELETE (No Filters)
            const { error: deleteError } = await sb
                .from('1in2')
                .delete()
                .neq('player_username', 'RESERVED_VOID_CHECK');

            if (deleteError) throw deleteError;

            // STEP 2: RESET THE REGISTRY (Lock the door)
            const { error: regError } = await sb
                .from('Leagues_Registry')
                .update({ is_active: false, start_time: null })
                .eq('id', '1in2');

            if (regError) throw regError;

            status.innerText = "SUCCESS: ARENA CLEARED";
            status.className = "text-[9px] text-green-500 font-black";
            btn.className = "w-full py-6 bg-green-600 text-white rounded-2xl font-black uppercase italic";
            btn.innerText = "WIPE COMPLETE";

            setTimeout(() => { location.reload(); }, 2000);

        } catch (err) {
            status.innerText = "ERROR: " + err.message;
            status.className = "text-[9px] text-red-600 font-black";
            btn.disabled = false;
            btn.innerText = "RETRY OVERRIDE";
            console.error("Critical Failure:", err);
        }
    }
</script>
