<div class="glass p-8 rounded-[2rem] border border-red-900/30 text-center">
    <h3 class="orbitron text-red-500 text-xs font-black uppercase tracking-widest mb-4 italic">Arena Security</h3>
    
    <button id="purge-btn" onclick="executeNuclearPurge()" 
        class="w-full py-6 bg-red-600 hover:bg-red-700 text-white rounded-2xl font-black uppercase italic tracking-tighter shadow-lg shadow-red-900/20 transition-all active:scale-95 group">
        <span class="group-hover:scale-110 transition-transform inline-block">Reset 1in2 Lobby</span>
    </button>
    
    <p id="purge-status" class="text-[9px] text-zinc-600 mt-4 font-bold uppercase tracking-widest">System Ready</p>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
    // 1. CONFIGURATION (Ensure these are your actual credentials)
    const SB_URL = 'https://tbvmgcknkwsucstedigd.supabase.co';
    const SB_KEY = 'YOUR_SUPABASE_SERVICE_ROLE_KEY'; // Use Service Role for bypass power
    const sb = window.supabase.createClient(SB_URL, SB_KEY);

    async function executeNuclearPurge() {
        const btn = document.getElementById('purge-btn');
        const status = document.getElementById('purge-status');
        
        if (!confirm("CONFIRM TOTAL PURGE? All players will be ejected.")) return;

        // Visual Feedback: Loading State
        btn.disabled = true;
        btn.innerText = "PURGING...";
        status.innerText = "EXECUTING DELETE COMMAND...";
        status.className = "text-[9px] text-blue-500 mt-4 font-black animate-pulse";

        try {
            // STEP 1: Wipe the 1in2 Lobby Table
            const { error: deleteError } = await sb
                .from('1in2')
                .delete()
                .not('player_username', 'is', null);

            if (deleteError) throw deleteError;

            // STEP 2: Optional - Reset Arena Flags in Registry
            await sb.from('Leagues_Registry')
                .update({ is_active: false })
                .eq('id', '1in2');

            // STEP 3: Verification
            const { data: verify } = await sb.from('1in2').select('id');
            
            if (verify.length === 0) {
                status.innerText = "SUCCESS: ARENA IS EMPTY";
                status.className = "text-[9px] text-green-500 mt-4 font-black";
                btn.classList.replace('bg-red-600', 'bg-green-600');
                btn.innerText = "LOBBY CLEARED";
                
                // Reset button after 3 seconds
                setTimeout(() => {
                    btn.disabled = false;
                    btn.innerText = "Reset 1in2 Lobby";
                    btn.classList.replace('bg-green-600', 'bg-red-600');
                    status.innerText = "System Ready";
                    status.className = "text-[9px] text-zinc-600 mt-4 font-bold uppercase";
                }, 3000);
            } else {
                throw new Error("GHOST DATA PERSISTS");
            }

        } catch (err) {
            console.error("Purge Failed:", err);
            status.innerText = "ERROR: " + err.message;
            status.className = "text-[9px] text-red-500 mt-4 font-black";
            btn.disabled = false;
            btn.innerText = "Retry Purge";
        }
    }
</script>
