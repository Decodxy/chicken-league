<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>1in2 Standings | Chicken League</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="security-bridge.js"></script>
    <script src="ui-bridge.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800;900&family=Orbitron:wght@900&display=swap');
        
        body { 
            background: #000; 
            color: #eff3f4; 
            font-family: 'Inter', sans-serif; 
            margin: 0; 
            -webkit-font-smoothing: antialiased; 
        }

        .font-chirp { font-weight: 900; letter-spacing: -0.04em; }
        .orbitron { font-family: 'Orbitron', sans-serif; }

        .glass-panel { 
            background: rgba(255, 255, 255, 0.02); 
            border: 1px solid rgba(255, 255, 255, 0.08); 
            border-radius: 1.5rem; 
        }

        .rank-row { 
            border-bottom: 1px solid rgba(255, 255, 255, 0.05); 
            transition: background 0.2s ease;
        }

        .rank-row:active { background: rgba(255, 255, 255, 0.05); }

        .top-1 { border-l-4 border-blue-600 bg-gradient-to-r from-blue-600/5 to-transparent; }

        /* Custom Scrollbar */
        #leaderboard-list::-webkit-scrollbar { width: 2px; }
        #leaderboard-list::-webkit-scrollbar-thumb { background: #3b82f6; }
    </style>
</head>
<body class="pt-20 pb-32">

    <main class="max-w-md mx-auto px-6">
        
        <div class="mb-8">
            <h1 class="font-chirp text-3xl uppercase tracking-tighter">STANDINGS</h1>
            <div class="flex justify-between items-center mt-2">
                <p class="text-blue-500 text-[10px] font-black uppercase tracking-[0.3em]">1IN2 DUO LEAGUE</p>
                <div class="flex items-center gap-2">
                    <span class="w-1.5 h-1.5 bg-blue-500 rounded-full animate-pulse"></span>
                    <span class="text-[9px] font-black text-zinc-500 uppercase">Live Feed</span>
                </div>
            </div>
        </div>

        <div class="glass-panel overflow-hidden">
            <div class="px-6 py-4 border-b border-white/10 flex justify-between items-center bg-white/5">
                <span class="text-[10px] font-black text-zinc-500 uppercase tracking-widest">Combatant</span>
                <span class="text-[10px] font-black text-zinc-500 uppercase tracking-widest">Weight (KG)</span>
            </div>

            <div id="leaderboard-list" class="max-h-[60vh] overflow-y-auto">
                <div class="p-20 text-center opacity-30 orbitron text-[10px] uppercase tracking-widest">
                    Polling Registry...
                </div>
            </div>
        </div>

        <div class="mt-8 pt-4 border-t border-white/5">
            <button onclick="location.href='1in2.html'" class="text-blue-500 text-[11px] font-black uppercase tracking-widest underline decoration-blue-500/30 underline-offset-8">
                RETURN TO ARENA LOBBY
            </button>
        </div>

    </main>

    <script>
        async function bootStandings() {
            const { data: { session } } = await sb.auth.getSession();
            if (!session) { window.location.href = "login.html"; return; }
            
            fetchRankings();

            // Real-time Sub
            sb.channel('leaderboard-sync')
              .on('postgres_changes', 
                  { event: '*', schema: 'public', table: 'league_performances', filter: 'league_id=eq.1in2' }, 
                  () => fetchRankings()
              )
              .subscribe();
        }

        async function fetchRankings() {
            const { data, error } = await sb
                .from('league_performances')
                .select('*')
                .eq('league_id', '1in2')
                .order('score', { ascending: false })
                .limit(50);

            if (!error) renderUI(data);
        }

        function renderUI(players) {
            const listEl = document.getElementById('leaderboard-list');
            if (!players || players.length === 0) {
                listEl.innerHTML = `<div class="p-20 text-center text-[10px] text-zinc-600 uppercase font-black">No Records In Registry</div>`;
                return;
            }

            listEl.innerHTML = players.map((player, index) => {
                const rank = index + 1;
                const isWinner = rank === 1;
                
                return `
                    <div class="rank-row p-5 flex justify-between items-center ${isWinner ? 'top-1' : ''}">
                        <div class="flex items-center gap-4">
                            <span class="orbitron text-lg font-black ${isWinner ? 'text-blue-500' : 'text-zinc-800'}">
                                ${rank.toString().padStart(2, '0')}
                            </span>
                            <div>
                                <p class="text-sm font-chirp uppercase leading-none">${player.username}</p>
                                <p class="text-[8px] text-zinc-600 font-bold uppercase mt-1">
                                    VERIFIED: ${new Date(player.created_at).toLocaleDateString()}
                                </p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="orbitron text-xl font-black ${isWinner ? 'text-white' : 'text-zinc-400'}">
                                ${player.score.toFixed(1)}
                            </p>
                            <p class="text-[9px] text-blue-500 font-black uppercase tracking-tighter">KG</p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        bootStandings();
    </script>
</body>
</html>
